# v0.5.0 Implementation Plans - Summary

## Overview

Kế hoạch chi tiết cho 2 tính năng chính của v0.5.0:

1. **Advanced RAG** - Vector Database Integration
2. **Redis Cache Backend** - Distributed caching

## 1. Advanced RAG - Vector Database Integration

### Mục tiêu
Nâng cấp RAG từ keyword-based (v0.4.0) lên semantic search với vector databases cho production-scale.

### Timeline: 5 tuần (Weeks 1-5)

#### Sprint 1 (Weeks 1-2): Foundation
**Files**: `embedding.go` (300 LOC), `vectorstore.go` (200 LOC)

```go
// Embedding Provider Interface
type EmbeddingProvider interface {
    Embed(ctx context.Context, text string) ([]float32, error)
    EmbedBatch(ctx context.Context, texts []string) ([][]float32, error)
    Dimensions() int
    Model() string
}

// Implementations
- OpenAIEmbedding (text-embedding-3-small/large)
- OllamaEmbedding (nomic-embed-text)
- CustomEmbedding (user function)
```

**Deliverables**:
- ✅ EmbeddingProvider interface
- ✅ 2+ embedding implementations
- ✅ 15+ unit tests
- ✅ Batch processing support

#### Sprint 2 (Week 3): Chroma Integration
**Files**: `vectorstore_chroma.go` (400 LOC), tests (20+)

```go
// Chroma - Local vector database (easy setup)
store := agent.NewChromaStore("http://localhost:8000")
builder.WithVectorRAG(embedder, store)
```

**Features**:
- CRUD operations (Add, Search, Delete, Update)
- Cosine similarity search
- Metadata filtering
- Integration tests with Docker

**Use case**: Development, small-scale production

#### Sprint 3 (Week 4): Qdrant Integration
**Files**: `vectorstore_qdrant.go` (400 LOC), tests (20+)

```go
// Qdrant - Production-ready vector database
store := agent.NewQdrantStore("localhost:6333")
builder.WithVectorRAG(embedder, store)
```

**Features**:
- High-performance search (<20ms for 100K docs)
- Hybrid search (keyword + vector)
- Distributed deployment support
- Cloud + self-hosted

**Use case**: Production, scalable deployments

#### Sprint 4 (Week 5): Advanced Features
**Files**: `rag_vector.go` (300 LOC)

```go
// Hybrid RAG (keyword + semantic)
builder.WithHybridRAG(
    embedder,
    vectorStore,
    &agent.HybridRAGConfig{
        SemanticWeight: 0.7,  // 70% semantic
        KeywordWeight:  0.3,  // 30% keyword
        RerankTopK:     10,
    },
)
```

**Features**:
- Hybrid search (TF-IDF + embeddings)
- Semantic reranking
- Embedding caching
- Performance benchmarks

### API Examples

```go
// Basic vector RAG
builder.WithVectorRAG(
    agent.NewOpenAIEmbedding("text-embedding-3-small", apiKey),
    agent.NewChromaStore("http://localhost:8000"),
)

// Advanced hybrid RAG
builder.WithHybridRAG(
    agent.NewOllamaEmbedding("nomic-embed-text", "http://localhost:11434"),
    agent.NewQdrantStore("localhost:6333"),
    &agent.HybridRAGConfig{
        SemanticWeight: 0.7,
        KeywordWeight:  0.3,
        UseReranking:   true,
    },
)
```

### Success Metrics
- ✅ Support 3+ vector databases (Chroma, Qdrant, Weaviate)
- ✅ 2+ embedding providers (OpenAI, Ollama)
- ✅ 80+ tests, all passing
- ✅ Vector search <50ms for 10K docs (Chroma)
- ✅ Vector search <20ms for 100K docs (Qdrant)
- ✅ Hybrid search combining best of both worlds

### Dependencies
```go
github.com/amikos-tech/chroma-go v0.1.0
github.com/qdrant/go-client v1.7.0
github.com/weaviate/weaviate-go-client v4.13.1 // Optional
```

### Files to Create
1. `agent/embedding.go` (~300 LOC)
2. `agent/vectorstore.go` (~200 LOC)
3. `agent/vectorstore_chroma.go` (~400 LOC)
4. `agent/vectorstore_qdrant.go` (~400 LOC)
5. `agent/rag_vector.go` (~300 LOC)
6. Tests: `*_test.go` for each
7. Examples: `rag_vector_chroma.go`, `rag_vector_qdrant.go`, `rag_hybrid.go`
8. Docs: `RAG_VECTOR_DATABASES.md`, `RAG_EMBEDDINGS.md`

**Total**: ~1,600 LOC + tests + examples + docs

---

## 2. Redis Cache Backend

### Mục tiêu
Thêm Redis-based caching cho distributed, persistent response caching trong production.

### Timeline: 2 tuần (Weeks 5-6)

#### Sprint 1 (Week 5): Foundation
**Files**: `cache_redis.go` (400 LOC)

```go
type RedisCache struct {
    client     redis.UniversalClient
    prefix     string
    defaultTTL time.Duration
    stats      *CacheStats
}

// Constructor
func NewRedisCache(addr, password string, db int, defaultTTL time.Duration) (*RedisCache, error)
func NewRedisCacheWithOptions(opts *RedisCacheOptions) (*RedisCache, error)
```

**Features**:
- Basic Get/Set/Delete operations
- Connection pooling
- TTL management
- Cache statistics tracking

**Tests**: 15+ unit tests with miniredis

#### Sprint 2 (Week 6): Production Features
**Advanced Features**:

```go
// Redis Cluster
builder.WithRedisCacheOptions(&agent.RedisCacheOptions{
    Addrs: []string{
        "redis-1:6379",
        "redis-2:6379", 
        "redis-3:6379",
    },
})

// Redis Sentinel
builder.WithRedisSentinelCache(&agent.RedisSentinelOptions{
    MasterName:    "mymaster",
    SentinelAddrs: []string{"sentinel-1:26379", "sentinel-2:26379"},
})
```

**Features**:
- Redis Cluster support
- Redis Sentinel support
- Batch operations (MGet/MSet)
- Pattern-based deletion
- Health checks
- Auto-reconnect
- Distributed locking (optional)

**Tests**: 30+ total tests (unit + integration with Docker)

### API Examples

```go
// Simple Redis cache
builder.WithRedisCache("localhost:6379", "", 0)

// With custom options
builder.WithRedisCacheOptions(&agent.RedisCacheOptions{
    Addrs:       []string{"localhost:6379"},
    Password:    "",
    DB:          0,
    PoolSize:    10,
    KeyPrefix:   "go-deep-agent:",
    DefaultTTL:  10 * time.Minute,
})

// Fallback strategy (dev vs prod)
if os.Getenv("ENV") == "development" {
    builder.WithMemoryCache(100, 5*time.Minute)
} else {
    builder.WithRedisCache(os.Getenv("REDIS_URL"), "", 0)
}
```

### Success Metrics
- ✅ Full Cache interface implementation
- ✅ Support standalone, cluster, sentinel
- ✅ 30+ tests, all passing
- ✅ Get operation <5ms (local Redis)
- ✅ Set operation <10ms (local Redis)
- ✅ Batch operations: 100 items in <50ms
- ✅ Auto-reconnect on failure
- ✅ Graceful fallback to MemoryCache

### Dependencies
```go
github.com/redis/go-redis/v9 v9.3.0
github.com/alicebob/miniredis/v2 v2.31.0 // Testing
```

### Files to Create
1. `agent/cache_redis.go` (~400 LOC)
2. `agent/cache_redis_test.go` (30+ tests)
3. `examples/cache_redis.go` (~300 LOC)
4. `examples/cache_comparison.go` (~200 LOC)
5. `docs/CACHING_GUIDE.md`
6. `docs/REDIS_DEPLOYMENT.md`

**Total**: ~900 LOC + tests + examples + docs

---

## Combined Timeline

### December 2025 (8 weeks)

| Week | Sprint | Focus | Deliverables |
|------|--------|-------|--------------|
| 1-2 | RAG S1 | Embedding Foundation | embedding.go, vectorstore.go, tests |
| 3 | RAG S2 | Chroma Integration | vectorstore_chroma.go, example |
| 4 | RAG S3 | Qdrant Integration | vectorstore_qdrant.go, example |
| 5 | RAG S4 + Redis S1 | Hybrid RAG + Redis Foundation | rag_vector.go, cache_redis.go |
| 6 | Redis S2 | Redis Production Features | cluster, sentinel, tests |
| 7-8 | Audio | Whisper + TTS | audio.go, examples |

### Total Estimated Work
- **LOC**: ~2,500 new lines of code
- **Tests**: ~110 new tests (RAG: 80, Redis: 30)
- **Examples**: ~10 new examples
- **Documentation**: 6 new guides

### Success Criteria v0.5.0
1. ✅ Advanced RAG with 3+ vector databases
2. ✅ Redis cache with cluster/sentinel support
3. ✅ Audio support (Whisper + TTS)
4. ✅ 400+ total tests (currently 320)
5. ✅ 50+ examples (currently 44)
6. ✅ Production-ready documentation

---

## Migration Strategy

### Backward Compatibility
All new features are **opt-in**, existing code continues to work:

```go
// v0.4.0 - Still works
builder.WithRAG(docs...)
builder.WithMemoryCache(100, 5*time.Minute)

// v0.5.0 - New features (optional)
builder.WithVectorRAG(embedder, vectorStore)
builder.WithRedisCache("localhost:6379", "", 0)
```

### Gradual Adoption
Users can adopt features incrementally:

1. **Start**: Use existing RAG + MemoryCache
2. **Step 1**: Switch to RedisCache (no code change, just config)
3. **Step 2**: Add vector RAG for better results
4. **Step 3**: Enable hybrid search for best performance

---

## Risk Mitigation

### Technical Risks
1. **Vector DB availability** → Fallback to keyword-based RAG
2. **Redis unavailable** → Fallback to MemoryCache
3. **Embedding API costs** → Support local Ollama embeddings
4. **Performance** → Batch operations, caching, benchmarks

### Mitigation Strategies
- Comprehensive error handling
- Graceful degradation
- Extensive testing (unit + integration)
- Clear documentation
- Real-world examples

---

## Next Steps

### Immediate Actions
1. Create GitHub milestone for v0.5.0
2. Create issues for each sprint
3. Set up Docker environments for testing
4. Begin Sprint 1: Embedding providers

### Community Engagement
1. Announce v0.5.0 plan on GitHub
2. Seek feedback on API design
3. Invite contributors for specific components
4. Share progress updates

---

## References

- **Detailed Plans**:
  - [Advanced RAG Plan](ADVANCED_RAG_PLAN.md) - Full implementation details
  - [Redis Cache Plan](REDIS_CACHE_PLAN.md) - Complete Redis integration
  
- **Current Status**:
  - [ROADMAP.md](../ROADMAP.md) - Full project roadmap
  - v0.4.0: Batch Processing, Basic RAG, MemoryCache
  
- **Examples**:
  - 44+ examples in `examples/` directory
  - 320+ tests with 65%+ coverage

---

**Status**: Planning Complete ✅  
**Next**: Begin implementation (Sprint 1 - Embedding Providers)  
**Target Release**: v0.5.0 - December 2025
