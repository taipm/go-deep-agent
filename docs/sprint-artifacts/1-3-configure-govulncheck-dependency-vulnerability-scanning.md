# Story 1.3: Configure govulncheck for Dependency Vulnerability Scanning

Status: drafted
Date Created: 2025-11-15
Epic: Epic 1 - Security Infrastructure Foundation

## Story

As a **Security Engineer**,
I want **govulncheck scanning táº¥t cáº£ dependencies**,
so that **known vulnerabilities trong third-party packages Ä‘Æ°á»£c detected**.

## Acceptance Criteria

**AC-1: Comprehensive dependency scanning coverage**
- **Given** govulncheck v1.1.4+ installed trong development environment
- **When** configure vulnerability scanning
- **Then** scanning covers:
  - Direct dependencies (8 dependencies tá»« go.mod)
  - Transitive dependencies (34 transitive dependencies)
  - Standard library vulnerabilities (Go 1.25.2 specific)
  - Vulnerability database: golang.org/x/vuln/vulndb (updated daily)
  - Total coverage: 42 packages (verified tá»« Story 1.1 baseline)

**AC-2: Multiple scan modes configured**
- **Given** govulncheck supports different scan modes
- **When** define scan configurations
- **Then** modes include:
  - Source mode: `govulncheck -json -mode=source ./...` (scan source code)
  - Binary mode: `govulncheck -json -mode=binary ./bin/*` (scan compiled artifacts)
  - Module mode: `govulncheck -json -mode=module` (scan go.mod only)
  - Default mode: source mode for comprehensive coverage

**AC-3: JSON output vá»›i detailed CVE information**
- **Given** vulnerability scan results
- **When** output format configured as JSON
- **Then** report includes:
  - CVE ID: standard CVE-YYYY-NNNNN format
  - Affected package: full import path
  - Current version: installed version
  - Fixed version: recommended upgrade version (if available)
  - Severity: based on CVSS score (critical/high/medium/low)
  - Description: vulnerability summary
  - References: links to CVE database, advisory, fix PR

**AC-4: Configuration file vÃ  documentation**
- **Given** govulncheck configuration needs
- **When** create configuration vÃ  documentation
- **Then** deliverables include:
  - `.govulncheck.yaml` configuration file (optional, for exclusions)
  - `docs/security/vulnerability-scanning.md` documentation vá»›i:
    - govulncheck overview vÃ  purpose
    - Scan modes explanation vÃ  use cases
    - Usage examples: source, binary, module modes
    - False positive handling procedures
    - Update frequency recommendations (daily CI, on-demand PRs)
    - Integration vá»›i GitHub Actions (teaser for Story 1.4)

**AC-5: False positive handling documented**
- **Given** some vulnerabilities may not affect go-deep-agent usage
- **When** encounter false positives
- **Then** handling process includes:
  - Document known safe usages trong `.govulncheck.yaml` exclusions
  - Justification required for each exclusion (why safe in this context)
  - Periodic review process (quarterly) to re-evaluate exclusions
  - Example exclusions format:
    ```yaml
    exclude:
      - id: GO-YYYY-NNNN
        reason: "Function not used in our codebase (only test imports)"
        expires: "2025-12-31"
    ```

**AC-6: Emergency response process documented**
- **Given** zero-day vulnerabilities can emerge
- **When** critical vulnerability discovered
- **Then** response process includes:
  - Severity assessment: critical (immediate), high (24h), medium (7d)
  - Notification channels: GitHub Security Advisory, team notification
  - Patch timeline: critical <48h, high <7d, medium <30d
  - Workaround documentation: temporary mitigations if patch unavailable
  - Documented trong `docs/security/vulnerability-response.md`

**AC-7: Configuration validation vÃ  testing**
- **Given** govulncheck configuration complete
- **When** validate configuration vÃ  scan
- **Then** validation results:
  - Scan completes successfully (exit code 0 = no vulns, 1 = vulns found)
  - JSON output validates (parseable, contains expected fields)
  - Scan duration: <1 minute typical, <5 minutes worst case
  - Baseline validation: 0 vulnerabilities (confirmed tá»« Story 1.1)
  - All 42 packages scanned (8 direct + 34 transitive)

## Tasks / Subtasks

### Task 1: Verify govulncheck installation vÃ  configuration (AC: AC-1, AC-2)
- [ ] **1.1** Verify govulncheck installed tá»« Story 1.1
  - Current version: v1.1.4 (confirmed trong Story 1.1)
  - Verify: `govulncheck --help` succeeds
  - Update if needed: `go install golang.org/x/vuln/cmd/govulncheck@latest`
- [ ] **1.2** Test vulnerability database access
  - Verify DB connection: `govulncheck -json -mode=source ./agent/...`
  - Database URL: https://pkg.go.dev/vuln
  - Confirm automatic updates working (no manual sync needed)
- [ ] **1.3** Document scan modes
  - Source mode: full source code analysis (default, most comprehensive)
  - Binary mode: compiled binary analysis (for deployment validation)
  - Module mode: go.mod only (fastest, less comprehensive)

### Task 2: Configure source mode scanning (AC: AC-2, AC-3)
- [ ] **2.1** Define source mode scan command
  - Command: `govulncheck -json -mode=source ./...`
  - Scan target: `./...` (all packages including agent/, examples/, tests/)
  - Output: JSON format vá»›i detailed CVE information
- [ ] **2.2** Test source mode scan
  - Run: `govulncheck -json -mode=source ./... > govulncheck-source.json`
  - Verify: JSON output parseable
  - Expected result: 0 vulnerabilities (baseline tá»« Story 1.1)
  - Measure duration: target <1 minute
- [ ] **2.3** Validate JSON output structure
  - Parse JSON: extract CVE ID, package, version, severity, fix
  - Verify fields present: ID, Package, CurrentVersion, FixedVersion, Details
  - Test edge case: handling when FixedVersion unavailable

### Task 3: Configure binary mode scanning (AC: AC-2, AC-3)
- [ ] **3.1** Define binary mode scan approach
  - Build binary: `go build -o bin/go-deep-agent ./examples/simple_chat/`
  - Scan command: `govulncheck -json -mode=binary ./bin/go-deep-agent`
  - Use case: validate production deployment artifacts
- [ ] **3.2** Test binary mode scan (optional - no binaries committed)
  - Build example binary for testing
  - Run scan: `govulncheck -json -mode=binary ./bin/go-deep-agent`
  - Compare results with source mode (should match for runtime dependencies)
  - Document differences: binary mode excludes test-only dependencies
- [ ] **3.3** Document binary scanning workflow
  - When to use: pre-deployment validation, release artifact scanning
  - Build command examples for different architectures
  - Integration vá»›i CI/CD release pipeline (Story 1.4 reference)

### Task 4: Create govulncheck configuration file (AC: AC-4, AC-5)
- [ ] **4.1** Create `.govulncheck.yaml` in project root
  - Purpose: document exclusions for false positives (initially empty)
  - Schema: `exclude` list vá»›i id, reason, expires fields
  - Validation: YAML syntax correct, schema valid
- [ ] **4.2** Document exclusion process
  - When to exclude: false positive, not used in codebase, test-only import
  - Required fields: CVE ID, justification, expiration date
  - Review process: quarterly review of all exclusions
  - Example exclusion entry:
    ```yaml
    # Example exclusion structure (currently no exclusions)
    exclude: []
    # Format for future exclusions:
    # - id: GO-YYYY-NNNN
    #   reason: "Function not called in our codebase"
    #   expires: "2025-12-31"
    #   reviewed_by: "Security Engineer"
    #   review_date: "2025-11-15"
    ```
- [ ] **4.3** Validate configuration file
  - Parse YAML: `govulncheck -config=.govulncheck.yaml -json -mode=source ./...`
  - Verify exclusions apply correctly (test vá»›i mock exclusion if needed)
  - Document configuration loading: automatic if present, no flag needed

### Task 5: Create vulnerability scanning documentation (AC: AC-4, AC-6)
- [ ] **5.1** Create `docs/security/vulnerability-scanning.md`
  - Overview: govulncheck purpose, vulnerability database
  - Scan modes: source vs binary vs module (comparison table)
  - Configuration: `.govulncheck.yaml` usage vÃ  exclusion process
  - Usage examples: local development, CI/CD integration
- [ ] **5.2** Document scan commands with examples
  - Source mode: `govulncheck -json -mode=source ./...`
  - Binary mode: `govulncheck -json -mode=binary ./bin/app`
  - Module mode: `govulncheck -json -mode=module`
  - Update DB: automatic (no manual action needed)
- [ ] **5.3** Document false positive handling
  - How to identify false positives (code not used, test-only)
  - Exclusion process: create entry trong `.govulncheck.yaml`
  - Review cycle: quarterly re-evaluation
  - Escalation: complex cases reviewed by security team
- [ ] **5.4** Document scan frequency recommendations
  - CI/CD: daily scheduled scan + every PR
  - Local development: before commit (optional pre-commit hook)
  - Release process: mandatory scan before deployment
  - Database updates: automatic daily sync

### Task 6: Create emergency response documentation (AC: AC-6)
- [ ] **6.1** Create `docs/security/vulnerability-response.md`
  - Overview: zero-day vÃ  critical vulnerability response
  - Severity classification: critical/high/medium/low with SLA
  - Response timeline: critical <48h, high <7d, medium <30d
  - Notification process: GitHub Security Advisory, team channels
- [ ] **6.2** Document response workflow
  - Step 1: Severity assessment (CVSS score + exploitability + impact)
  - Step 2: Immediate mitigation (workaround if patch unavailable)
  - Step 3: Patch development/testing (upgrade dependency or apply fix)
  - Step 4: Deployment vÃ  verification (confirm vulnerability resolved)
  - Step 5: Post-incident review (lessons learned, process improvement)
- [ ] **6.3** Document emergency contacts vÃ  escalation
  - Primary: Security Engineer (Story owner)
  - Secondary: DevOps Engineer (CI/CD owner)
  - Escalation: Project maintainer for critical decisions
  - External: Dependency maintainers, Go security team if needed

### Task 7: Validate configuration vÃ  testing (AC: AC-7)
- [ ] **7.1** Validate baseline scan results
  - Run: `govulncheck -json -mode=source ./...`
  - Expected: 0 vulnerabilities (matching Story 1.1 baseline)
  - Verify: all 42 packages scanned (8 direct, 34 transitive)
  - Parse JSON: confirm CVE fields structure correct
- [ ] **7.2** Test scan performance
  - Measure: full source scan duration
  - Target: <1 minute typical
  - Document: actual duration, packages scanned, DB update time
  - Compare vá»›i Story 1.1: ~3 seconds baseline (expect similar)
- [ ] **7.3** Test configuration file loading
  - Verify `.govulncheck.yaml` loads correctly
  - Test exclusion mechanism (add temporary test exclusion, verify skipped)
  - Remove test exclusion, confirm config clean for commit
- [ ] **7.4** Validate JSON output completeness
  - Required fields present: ID, Package, CurrentVersion, Details
  - Optional fields handled: FixedVersion (may be empty for zero-day)
  - Edge cases: multiple vulnerabilities, nested dependencies
- [ ] **7.5** Document scan results vÃ  performance
  - Scan duration: {{actual_time}} (target met: <1 minute)
  - Packages scanned: 42 (8 direct, 34 transitive)
  - Vulnerabilities found: 0 âœ… (production-ready baseline)
  - Database version: {{vuln_db_date}}

### Task 8: Commit configuration vÃ  documentation (AC: AC-4, AC-6)
- [ ] **8.1** Review deliverables
  - `.govulncheck.yaml`: configuration file (initially empty exclusions)
  - `docs/security/vulnerability-scanning.md`: comprehensive usage guide
  - `docs/security/vulnerability-response.md`: emergency response process
  - All documents tested, examples verified
- [ ] **8.2** Commit to version control
  ```bash
  git add .govulncheck.yaml docs/security/vulnerability-scanning.md docs/security/vulnerability-response.md
  git commit -m "security: Configure govulncheck dependency vulnerability scanning

  - govulncheck v1.1.4+ configuration
  - Scan modes: source (default), binary, module
  - Output format: JSON vá»›i CVE details
  - False positive handling: .govulncheck.yaml exclusions
  - Emergency response process documented
  - Documentation: vulnerability-scanning.md, vulnerability-response.md
  - Baseline validation: 0 vulnerabilities âœ…

  Scan coverage: 42 packages (8 direct, 34 transitive)
  Performance: <1 minute (target met)

  Prerequisites: Story 1.1 baseline complete
  Next: Story 1.4 (GitHub Actions CI/CD integration)
  "
  ```

## Dev Notes

### Learnings from Previous Story

**From Story 1.1 (Status: done)**

- **Zero Vulnerabilities Confirmed**: govulncheck found 0 CVEs trong 42 dependencies (8 direct, 34 transitive) âœ…
- **Scan Performance**: govulncheck completed in ~3 seconds (well below 1 minute target)
- **Tool Version Confirmed**: govulncheck v1.1.4 installed vÃ  working correctly
- **Examples Directory Challenge**: Multiple main functions caused build errors - govulncheck scanned production code (`./agent/...`) separately in Story 1.1 to avoid false failures
- **Database Access Verified**: Vulnerability database accessible, automatic updates working

**From Story 1.2 (Status: ready-for-dev)**

- **Configuration Pattern Established**: `.gosec.json` configuration file in project root - follow same pattern vá»›i `.govulncheck.yaml`
- **Documentation Location**: `docs/security/` directory established - add `vulnerability-scanning.md` vÃ  `vulnerability-response.md` here
- **Exclusion Pattern**: Story 1.2 defined exclusion structure for gosec - adapt for govulncheck false positives
- **Performance Targets**: gosec <2 minutes, govulncheck <1 minute - consistent performance standards

**Key Insights for Story 1.3:**

1. **Baseline is Clean**: 0 vulnerabilities means this story focuses on configuration vÃ  process, not remediation
2. **Examples Directory**: May need same exclusion as Story 1.1 (`./agent/...` instead of `./...`) if build errors persist
3. **Performance Budget**: Story 1.1 took 3 seconds - configuration overhead minimal, well within <1 minute target
4. **Configuration File**: Unlike gosec (required), `.govulncheck.yaml` is optional - only create for exclusions/documentation
5. **Documentation Consistency**: Follow same structure as Story 1.2's `security-scanning.md` for familiarity

**Files Created in Previous Stories:**
- `docs/security/security-baseline-report.md` (Story 1.1) - Reference for baseline validation
- `docs/security/security-scanning.md` (Story 1.2) - Pattern for vulnerability-scanning.md
- `.gosec.json` (Story 1.2) - Pattern for `.govulncheck.yaml` structure

**Recommended Approach:**
- Start with source mode scan (most comprehensive, matches Story 1.1)
- Create `.govulncheck.yaml` even if initially empty (documents future exclusion process)
- Follow documentation structure from Story 1.2 for consistency
- Test binary mode scan but don't commit binaries (documentation only)
- Emphasize zero vulnerabilities as production-ready achievement

[Source: docs/sprint-artifacts/1-1-project-security-audit-baseline-assessment.md#Dev-Agent-Record]
[Source: docs/sprint-artifacts/1-2-configure-gosec-comprehensive-security-scanning.md#Learnings-from-Previous-Story]

### Architecture Patterns and Constraints

**From Architecture (architecture.md):**

**Epic 1 Guidance:**
- **Tools Stack**: gosec v2.22.10, govulncheck v1.1.4+, golangci-lint v2.6.1
- **Integration**: GitHub Actions vá»›i SARIF upload to GitHub Security tab (Story 1.4)
- **Configuration**: `.govulncheck.yaml` in project root (optional, for exclusions)
- **Documentation**: `docs/security/vulnerability-scanning.md`, `vulnerability-response.md`

**Security Scanning Strategy:**
- **Layered Approach**: gosec (code patterns) + govulncheck (dependencies) + golangci-lint (comprehensive)
- **Complementary Tools**: Each serves distinct purpose vá»›i minimal overlap
- **Automated Detection**: All tools run in CI/CD (Story 1.4)
- **Performance Targets**: gosec <2min, govulncheck <1min, total <5min

**Project Structure:**
```
go-deep-agent/
â”œâ”€â”€ .gosec.json                          # âœ… Story 1.2
â”œâ”€â”€ .govulncheck.yaml                    # ðŸ†• This story (optional)
â”œâ”€â”€ docs/security/
â”‚   â”œâ”€â”€ security-baseline-report.md      # âœ… Story 1.1
â”‚   â”œâ”€â”€ security-scanning.md             # âœ… Story 1.2
â”‚   â”œâ”€â”€ vulnerability-scanning.md        # ðŸ†• This story
â”‚   â””â”€â”€ vulnerability-response.md        # ðŸ†• This story
â””â”€â”€ .github/workflows/
    â””â”€â”€ security-scan.yml                # â³ Story 1.4
```

**Configuration Standards:**
- **File Format**: YAML vá»›i inline comments (follows Go community convention)
- **Validation**: govulncheck loads config automatically if `.govulncheck.yaml` present
- **Documentation**: Every exclusion must be documented vá»›i justification vÃ  expiration
- **Performance**: <1 minute scan target (Story 1.1 was 3 seconds baseline)

**Vulnerability Management:**
- **Detection**: govulncheck daily scans + PR scans
- **Response SLA**: Critical <48h, High <7d, Medium <30d
- **Database**: golang.org/x/vuln/vulndb (official Go vulnerability database)
- **Automation**: Automatic database updates, no manual intervention

[Source: docs/architecture.md#Epic-1-Security-Infrastructure-Foundation]
[Source: docs/architecture.md#ADR-0001-Security-Tooling-Stack]

### Source Tree Components

**Files to Create:**
- `.govulncheck.yaml` - Configuration file for exclusions (initially empty, documents process)
- `docs/security/vulnerability-scanning.md` - govulncheck usage documentation
- `docs/security/vulnerability-response.md` - Emergency response process

**Files to Reference:**
- `docs/security/security-baseline-report.md` - Story 1.1 baseline (0 vulnerabilities)
- `docs/security/security-scanning.md` - Story 1.2 pattern for documentation structure
- `.gosec.json` - Story 1.2 configuration pattern to follow
- `go.mod` - 42 dependencies to scan (8 direct, 34 transitive)

**No Code Changes Required:**
- This story is pure configuration vÃ  documentation
- No changes to `agent/` packages
- No changes to examples (may scan separately nhÆ° Story 1.1)

**Dependencies:**
- govulncheck v1.1.4+ (already installed in Story 1.1)
- Go 1.25.2 (confirmed in Story 1.1)
- Vulnerability database access (verified in Story 1.1)

### Testing Standards

**Configuration Validation Tests:**

1. **Scan Completeness Test:**
   - Run: `govulncheck -json -mode=source ./...`
   - Expected: 0 vulnerabilities (matching Story 1.1 baseline)
   - Verify: all 42 packages scanned (8 direct + 34 transitive)
   - Validate: JSON output parseable vá»›i correct structure

2. **Scan Mode Tests:**
   - **Source Mode**: `govulncheck -json -mode=source ./...`
     - Expected: comprehensive scan, all packages
   - **Binary Mode** (optional): `govulncheck -json -mode=binary ./bin/app`
     - Expected: runtime dependencies only (excludes test-only deps)
   - **Module Mode**: `govulncheck -json -mode=module`
     - Expected: fastest scan, go.mod only

3. **Configuration File Test:**
   - Create `.govulncheck.yaml` vá»›i test exclusion
   - Run: `govulncheck -json -mode=source ./...`
   - Expected: exclusion applied correctly
   - Cleanup: remove test exclusion, verify config clean

4. **JSON Output Validation:**
   - Parse JSON output: extract required fields (ID, Package, Version, Details)
   - Verify field types: strings, arrays, objects as expected
   - Edge cases: empty results (0 vulns), multiple vulns, nested deps

5. **Performance Test:**
   - Measure: full source scan duration
   - Target: <1 minute typical, <5 minutes worst case
   - Story 1.1 baseline: 3 seconds (expect similar)
   - Document: actual duration, DB update time

6. **Database Connectivity Test:**
   - Verify DB access: successful connection to pkg.go.dev/vuln
   - Check updates: confirm automatic updates working
   - Error handling: test network failure scenario (optional)

**Documentation Quality Tests:**

- `vulnerability-scanning.md` includes: overview, scan modes, usage examples, false positive handling
- `vulnerability-response.md` includes: severity classification, response timeline, workflow, contacts
- All code snippets tested vÃ  verified
- Links to external references valid (vuln DB, CVE database, Go security)

### Project Structure Notes

**Alignment with Project Structure:**
- Configuration location: `.govulncheck.yaml` (project root, standard convention)
- Documentation: `docs/security/` directory (established in Story 1.1)
- No conflicts vá»›i existing structure
- Follows Go community conventions (`.govulncheck.yaml` is emerging standard)

**Directory Structure After Story:**
```
go-deep-agent/
â”œâ”€â”€ .gosec.json                          # âœ… Story 1.2
â”œâ”€â”€ .govulncheck.yaml                    # ðŸ†• NEW
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ security/
â”‚       â”œâ”€â”€ security-baseline-report.md  # âœ… Story 1.1
â”‚       â”œâ”€â”€ security-scanning.md         # âœ… Story 1.2
â”‚       â”œâ”€â”€ vulnerability-scanning.md    # ðŸ†• NEW
â”‚       â””â”€â”€ vulnerability-response.md    # ðŸ†• NEW
â””â”€â”€ (existing structure unchanged)
```

**govulncheck Integration Points:**
- **Local Development**: `govulncheck -json -mode=source ./...` (manual execution)
- **Pre-commit Hook**: Optional check before commit (developer choice)
- **CI/CD**: Story 1.4 will integrate into GitHub Actions
- **Release Process**: Mandatory scan before deployment (future enhancement)

**Vulnerability Database:**
- **Source**: https://pkg.go.dev/vuln (official Go vulnerability database)
- **Updates**: Automatic daily sync (no manual intervention)
- **Format**: JSON API vá»›i CVE details
- **Coverage**: Go standard library + ecosystem packages

### References

**Primary Sources:**
1. [Epic 1 Description](../epics.md#Epic-1-Security-Infrastructure-Foundation) - Epic goals vÃ  business value
2. [Story 1.3 Details](../epics.md#Story-1.3-Configure-govulncheck-Dependency-Vulnerability-Scanning) - Acceptance criteria vÃ  technical notes
3. [Architecture - Epic 1](../architecture.md#Epic-1-Security-Infrastructure-Foundation) - Architecture decisions vÃ  patterns
4. [Story 1.1 Completion](./1-1-project-security-audit-baseline-assessment.md) - Baseline metrics (0 vulnerabilities)
5. [Story 1.2 Draft](./1-2-configure-gosec-comprehensive-security-scanning.md) - Configuration patterns to follow

**Tool Documentation:**
- govulncheck: https://pkg.go.dev/golang.org/x/vuln/cmd/govulncheck
- Vulnerability database: https://pkg.go.dev/vuln
- Go security policy: https://go.dev/security
- CVE database: https://cve.mitre.org/

**Related Stories:**
- **Story 1.1** (done): Baseline assessment - confirmed 0 vulnerabilities âœ…
- **Story 1.2** (ready-for-dev): gosec configuration - parallel security scanning setup
- **Story 1.4** (backlog): GitHub Actions CI/CD - will use govulncheck configuration
- **Story 1.5** (backlog): golangci-lint integration - comprehensive quality gate

## Dev Agent Record

### Context Reference

<!-- Path(s) to story context XML will be added here by context workflow -->

### Agent Model Used

{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List

## Change Log

- **2025-11-15:** Story created (status: drafted)
  - Derived from Epic 1, Story 1.3
  - Previous story: 1-2-configure-gosec-comprehensive-security-scanning (ready-for-dev)
  - Learnings incorporated: 0 vulnerabilities baseline, configuration patterns, documentation structure
  - Ready for story-context generation
